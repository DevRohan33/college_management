{% extends 'teacher_base.html' %}

{% block content %}
<div class="container mt-4">
  <!-- Header Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <h2 class="mb-0"><i class="fas fa-tasks me-2"></i>{{ assignment.title }}</h2>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-2"><strong><i class="fas fa-info-circle me-2"></i>Details:</strong><br>{{ assignment.details }}</p>
          <p class="mb-2"><strong><i class="fas fa-user-tie me-2"></i>Created By:</strong> {{ assignment.created_by }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-2"><strong><i class="fas fa-calendar-alt me-2"></i>Submit Before:</strong><br>
            <span class="badge bg-info text-dark fs-6">{{ assignment.submit_last_date }}</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Section with Chart -->
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Submission Analytics</h5>
        </div>
        <div class="card-body d-flex align-items-center justify-content-center">
          <canvas id="submissionChart" style="max-width: 300px; max-height: 300px;"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Statistics</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-around text-center mb-4">
            <div>
              <span class="display-4 text-success">{{ submitted_count }}</span>
              <p class="mt-2"><span class="badge bg-success">Submitted</span></p>
            </div>
            <div>
              <span class="display-4 text-danger">{{ due_count }}</span>
              <p class="mt-2"><span class="badge bg-danger">Due</span></p>
            </div>
          </div>
          <div class="progress" style="height: 25px;">
            <div class="progress-bar bg-success" role="progressbar" 
                 style="width: {{ progress_percentage }}%;" 
                 aria-valuenow="{{ progress_percentage }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
              {{ progress_percentage }}% Complete
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Submitted Students -->
  <div class="card shadow-sm mt-4">
    <div class="card-header bg-success text-white">
      <h4 class="mb-0"><i class="fas fa-check-circle me-2"></i>Submitted Students ({{ submitted_count }})</h4>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th><i class="fas fa-user me-1"></i> Student</th>
              <th><i class="fas fa-id-card me-1"></i> Reg No</th>
              <th><i class="fas fa-envelope me-1"></i> Email</th>
              <th><i class="fas fa-phone me-1"></i> Mobile</th>
              <th><i class="fas fa-graduation-cap me-1"></i> Semester</th>
              <th><i class="fas fa-clock me-1"></i> Submitted At</th>
              <th><i class="fas fa-file-download me-1"></i> File</th>
            </tr>
          </thead>
          <tbody>
            {% for sub in submitted %}
            <tr>
              <td>{{ sub.student_name }}</td>
              <td>{{ sub.registration_number }}</td>
              <td><a href="mailto:{{ sub.email }}">{{ sub.email }}</a></td>
              <td><a href="tel:{{ sub.mobile }}">{{ sub.mobile }}</a></td>
              <td><span class="badge bg-primary">{{ sub.semester }}</span></td>
              <td><small class="text-muted">{{ sub.submitted_at|date:"M d, Y, g:i a" }}</small></td>
              <td>
                <a href="{{ sub.file.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                  <i class="fas fa-download me-1"></i>Download
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center py-4">
                <i class="fas fa-inbox fa-2x mb-2 text-muted"></i>
                <p class="text-muted">No submissions yet.</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Due Students -->
  <div class="card shadow-sm mt-4">
    <div class="card-header bg-warning text-dark">
      <h4 class="mb-0"><i class="fas fa-clock me-2"></i>Due Students ({{ due_count }})</h4>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th><i class="fas fa-user me-1"></i> Student</th>
              <th><i class="fas fa-id-card me-1"></i> Reg No</th>
              <th><i class="fas fa-envelope me-1"></i> Email</th>
              <th><i class="fas fa-phone me-1"></i> Mobile</th>
              <th><i class="fas fa-graduation-cap me-1"></i> Semester</th>
            </tr>
          </thead>
          <tbody>
            {% for student in due_students %}
            <tr>
              <td>{{ student.name }}</td>
              <td>{{ student.registration_number }}</td>
              <td><a href="mailto:{{ student.email }}">{{ student.email }}</a></td>
              <td><a href="tel:{{ student.phone_number }}">{{ student.phone_number }}</a></td>
              <td><span class="badge bg-primary">{{ student.user.semester }}</span></td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center py-4">
                <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
                <p class="text-success">No due students ðŸŽ‰</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script>
const ctx = document.getElementById('submissionChart').getContext('2d');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Submitted', 'Due'],
    datasets: [{
      data: [{{ submitted_count }}, {{ due_count }}],
      backgroundColor: ['#28a745', '#dc3545'],
      borderWidth: 2,
      borderColor: '#ffffff'
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: true,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          padding: 20,
          usePointStyle: true
        }
      }
    },
    cutout: '70%'
  }
});
</script>

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/your-kit-id.js" crossorigin="anonymous"></script>
{% endblock %}

<style>
.card {
  border: none;
  border-radius: 12px;
}

.card-header {
  border-radius: 12px 12px 0 0 !important;
}

.table th {
  border-top: none;
  font-weight: 600;
}

.badge {
  font-size: 0.85em;
}

.progress {
  border-radius: 10px;
}

.progress-bar {
  border-radius: 10px;
  font-weight: 600;
}

.table-hover tbody tr:hover {
  background-color: rgba(0, 123, 255, 0.1);
}
</style>