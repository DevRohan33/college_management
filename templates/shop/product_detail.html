{% extends 'student_base.html' %}
{% block title %}{{ product.title }} - Elitte Shop{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="row g-4">
    <div class="col-md-6">
      {% if product.default_image %}
      <img src="{{ product.default_image.url }}" class="img-fluid rounded"/>
      {% endif %}
      <div class="mt-3 d-flex flex-wrap gap-2">
        {% for img in product.images.all %}
          <img src="{{ img.image.url }}" class="rounded" style="width:80px;height:80px;object-fit:cover;"/>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-6">
      <h3>{{ product.title }}</h3>
      <div class="text-muted mb-2">₹{{ product.price }}</div>
      <div class="mb-2"><i class="fas fa-star text-warning"></i> {{ product.average_rating }}</div>
      <p>{{ product.description }}</p>

      <form method="post" class="mb-3">
        {% csrf_token %}
        <button name="add_cart" class="btn btn-outline-secondary me-2"><i class="fas fa-cart-plus"></i> Add to Cart</button>
        <button name="buy_now" class="btn btn-primary"><i class="fas fa-bolt"></i> Buy Now</button>
      </form>

      <div class="card">
        <div class="card-body">
          <h6 class="mb-2">Seller Details</h6>
          <div><strong>{{ product.seller.get_full_name|default:product.seller.username }}</strong></div>
          <div class="small text-muted">Department: {{ product.seller.department.name|default:'-' }} | Semester: {{ product.seller.semester.semester|default:'-' }}</div>
          <div class="mt-1"><i class="fas fa-star text-warning"></i> Seller Rating: {{ seller_profile.rating }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <h5>Reviews</h5>
    {% for r in reviews %}
      <div class="border rounded p-2 mb-2">
        <div class="small text-muted">{{ r.reviewer.get_full_name|default:r.reviewer.username }} • {{ r.created_at|date:'M d, Y' }}</div>
        <div><i class="fas fa-star text-warning"></i> {{ r.rating }} - {{ r.comment }}</div>
      </div>
    {% empty %}
      <div class="text-muted">No reviews yet.</div>
    {% endfor %}
  </div>

  <div class="mt-5">
    <h5>Recommended</h5>
    <div class="row g-3">
      {% for p in recommended %}
      <div class="col-md-3">
        <div class="card h-100">
          {% if p.default_image %}
          <img src="{{ p.default_image.url }}" class="card-img-top" style="height:120px;object-fit:cover;">
          {% endif %}
          <div class="card-body">
            <h6 class="card-title mb-1">{{ p.title }}</h6>
            <div class="text-muted small mb-2">₹{{ p.price }}</div>
            <div class="text-warning"><i class="fas fa-star"></i> {{ p.average_rating }}</div>
            <a href="{% url 'shop_product_detail' p.id %}" class="stretched-link"></a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
